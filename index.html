
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>pizza</title>
    <script type="text/javascript">

      function writeMessage( canvas, message )
      {
        var context = canvas.getContext('2d');
        context.clearRect(0, 0, canvas.width, canvas.height);
        context.font = '18pt Calibri';
        context.fillStyle = 'black';
        context.fillText(message, 10, 25);
      }

      function getMousePos( canvas, evt )
      {
        var rect = canvas.getBoundingClientRect();
        return {
          x: evt.clientX - rect.left,
          y: evt.clientY - rect.top
        };
      }

      var FPS = 60;
      function init()
      {
        setInterval( function() { draw(); }, 1000 / FPS );
      }

      // Temporary variables to hold mouse x-y pos.s
      var tempX = 0
      var tempY = 0

      var counter = -100;
      var dir = 1;

      var mousePos = { x: 0, y: 0 };

      function getContext()
      {
        var canvas = document.getElementById( 'pizza' );
        if ( !canvas.getContext )
        {
          return;
        }

        canvas.addEventListener( 'mousemove', function( evt )
        {
          mousePos = getMousePos( canvas, evt );
          // var message = 'Mouse position: ' + mousePos.x + ',' + mousePos.y;
          // writeMessage( canvas, message );
        }, false);

        var ctx = canvas.getContext( '2d' );
        return ctx;
      }

      var ctx;

      var frameRate = 0;

      function draw()
      {
        start = window.performance.now();

        var canvas = document.getElementById( 'pizza' );
        if ( !canvas.getContext )
        {
          return;
        }
        if ( !ctx )
        {
          ctx = getContext();
        }

        counter += dir;
        var counterMax = 70;
        if ( counter > counterMax ) dir = -1;
        if ( counter <= -100 ) dir = 1;

        canvas.width  = window.innerWidth * 0.9;
        canvas.height = window.innerHeight * 0.9;
        ratio = canvas.height / canvas.width;

        var num_cols = 20;
        var num_rows = ratio * num_cols;
        var cell_width = canvas.width / num_cols;
        var cell_height = canvas.height / num_rows;

        // var cell_width = 100;
        // var cell_height = 20;
        // var num_cols = ( canvas.width / cell_width ).toFixed( 0 );
        // var num_rows = ( canvas.height / cell_height ).toFixed( 0 );
        var red = 0;
        var green = 0;
        var blue = 0;
        var c = ( 255.0 * Math.pow( ( counter + 100 ) / ( counterMax + 100 ), 4 ) ).toFixed(0);
        ctx.fillStyle = "rgb(" + 0 + "," + c + "," + 0 + ")";
        ctx.fillRect( 0, 0, canvas.width, canvas.height );
        for ( var y = 0; y < num_rows; y++ )
        {
          for ( var x = 0.0; x < num_cols; x++ )
          {
            red = 0;
            green = counter.toFixed(0);//( 256.0 * ( x / num_cols ) ).toFixed(0);
            blue = ( 256.0 * ( (  x + ( x % 2 == 0 ? y : -y ) + counter * 0.5 ) / num_cols ) ).toFixed(0);
            // red = ( blue * 0.5 ).toFixed(0);
            var alpha = 1;
            cell_size = Math.pow(blue / 256, 0.1);
            ctx.fillStyle = "rgb(" + red + "," + green + "," + blue + ")";
            ctx.fillRect( x * cell_width, y * cell_height, cell_width * cell_size, cell_height * cell_size );
          }
        }
        red += 90 + Math.abs( counter );
        ctx.fillStyle = "rgba(" + red + "," + green + "," + blue + "," + alpha + ")";

        ctx.beginPath();
        ctx.arc( mousePos.x, mousePos.y, cell_width * 0.5, 0, 2 * Math.PI, false );
        ctx.fill();
        ctx.stroke();
        ctx.closePath();

        stop = window.performance.now();
        elapsed = stop - start;
        frameRate = 0.99 * frameRate + 0.01 * elapsed;
        // var message = 'Mouse position: ' + mousePos.x + ',' + mousePos.y;
        // writeMessage( canvas, frameRate );
      }

    </script>
    <style type="text/css">
      canvas { border: 1px solid black; }
    </style>
  </head>
  <body onload="init();">
    <canvas id="pizza" width="1" height="1"></canvas>
    <p>pizza</p>
  </body>
</html>
